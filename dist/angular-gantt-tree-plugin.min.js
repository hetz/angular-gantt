!function(){"use strict";angular.module("gantt.tree",["gantt","gantt.tree.templates","ui.tree"]).directive("ganttTree",["ganttUtils","$compile","$document",function(a,b,c){return{restrict:"E",require:"^gantt",scope:{enabled:"=?",header:"=?",content:"=?",headerContent:"=?",keepAncestorOnFilterRow:"=?",preCollapsedRootRows:"=?"},link:function(a,d,e,f){var g=f.gantt.api;if(a.options&&"object"==typeof a.options.tree)for(var h in a.options.tree)a[h]=a.options.tree[h];void 0===a.enabled&&(a.enabled=!0),void 0===a.header&&(a.header="Name"),void 0===a.headerContent&&(a.headerContent="{{getHeader()}}"),void 0===a.keepAncestorOnFilterRow&&(a.keepAncestorOnFilterRow=!1),void 0===a.preCollapsedRootRows&&(a.preCollapsedRootRows=[]),g.directives.on.new(a,function(d,e,f){if("ganttSideContent"===d){var g=e.$new();g.pluginScope=a;var h=c[0].createElement("div");angular.element(h).attr("data-ng-if","pluginScope.enabled"),angular.element(h).addClass("side-element");var i=c[0].createElement("gantt-side-content-tree");angular.element(h).append(i),f.append(b(h)(g))}})}}}])}(),function(){"use strict";angular.module("gantt.tree").directive("ganttRowTreeLabel",["GanttDirectiveBuilder",function(a){var b=new a("ganttRowTreeLabel");return b.restrict="A",b.templateUrl=void 0,b.build()}])}(),function(){"use strict";angular.module("gantt.tree").directive("ganttSideContentTree",["GanttDirectiveBuilder",function(a){return new a("ganttSideContentTree","plugins/tree/sideContentTree.tmpl.html").build()}])}(),function(){"use strict";angular.module("gantt.tree").controller("GanttTreeController",["$scope","$filter","GanttHierarchy","ganttArrays",function(a,b,c,d){a.rootRows=[],a.getHeader=function(){return a.pluginScope.header},a.toCollapse=function(b){return d.isInArray(a.pluginScope.preCollapsedRootRows,b.model.name)};var e=new c;a.pluginScope.$watchGroup(["keepAncestorOnFilterRow","enabled"],function(c){if(c[0]&&c[1]){var d=function(a,c,d){e.refresh(a);for(var f=[],g=0;g<a.length;g++)f.push(a[g]);var h=b("filter")(f,c,d),i=function(a){if(h.indexOf(a)>-1)return!0;for(var b=e.descendants(a),c=0;c<b.length;c++)if(h.indexOf(b[c])>-1)return!0;return!1};return b("filter")(a,i,d)};a.gantt.rowsManager.setFilterImpl(d)}else a.gantt.rowsManager.setFilterImpl(!1)});var f=function(b){for(var c=a.parent(b);void 0!==c;){if(void 0!==c&&c._collapsed)return!1;c=a.parent(c)}return!0},g=function(a){return a.filter(function(a){return f(a)})},h=function(b){for(var c=[],d=[],e=0;e<b.length;e++){void 0===a.parent(b[e])?d.push(b[e]):!0}var f=function(d){c.push(d);var e=a.children(d);if(void 0!==e&&e.length>0)for(var g=e.sort(function(a,c){return b.indexOf(a)-b.indexOf(c)}),h=0;h<g.length;h++)f(g[h])};for(e=0;e<d.length;e++)f(d[e]);return c};a.gantt.api.rows.addRowSorter(h),a.gantt.api.rows.addRowFilter(g),a.$on("$destroy",function(){a.gantt.api.rows.removeRowSorter(h),a.gantt.api.rows.removeRowFilter(g)});var i=function(){a.rootRows=e.refresh(a.gantt.rowsManager.filteredRows),a.gantt.rowsManager.filteredRows.length>0&&(a.gantt.api.rows.sort(),a.gantt.api.rows.refresh())};a.gantt.api.rows.on.remove(a,i),a.gantt.api.rows.on.add(a,i);var j=function(b){var c;if(void 0!==(c="string"==typeof b?a.gantt.rowsManager.rowsMap[b]:b))return void 0!==c._collapsed&&c._collapsed},k=function(b){var c;if(void 0!==(c="string"==typeof b?a.gantt.rowsManager.rowsMap[b]:b)){var d=a.nodeScopes[c.model.id];d.collapsed&&d.toggle()}},l=function(b){var c;if(void 0!==(c="string"==typeof b?a.gantt.rowsManager.rowsMap[b]:b)){var d=a.nodeScopes[c.model.id];d.collapsed||d.toggle()}},m=function(){return e};a.getHeaderContent=function(){return a.pluginScope.headerContent},a.gantt.api.registerMethod("tree","refresh",i,this),a.gantt.api.registerMethod("tree","isCollapsed",j,this),a.gantt.api.registerMethod("tree","expand",k,this),a.gantt.api.registerMethod("tree","collapse",l,this),a.gantt.api.registerEvent("tree","collapsed"),a.gantt.api.registerMethod("tree","getHierarchy",m,this),a.$watchCollection("gantt.rowsManager.filteredRows",function(){i()}),a.children=function(b){return void 0===b?a.rootRows:e.children(b)},a.parent=function(a){return e.parent(a)},a.nodeScopes={}}]).controller("GanttUiTreeController",["$scope",function(a){var b=function(){a.$broadcast("angular-ui-tree:collapse-all")},c=function(){a.$broadcast("angular-ui-tree:expand-all")};a.gantt.api.registerMethod("tree","collapseAll",b,a),a.gantt.api.registerMethod("tree","expandAll",c,a)}]).controller("GanttTreeNodeController",["$scope",function(a){a.$parent.nodeScopes[a.row.model.id]=a,a.$on("$destroy",function(){delete a.$parent.nodeScopes[a.row.model.id]}),a.$watch("children(row)",function(b){if(b){for(var c=a.row.rowsManager.filteredRows,d=[],e=0;e<b.length;e++){var f=b[e];c.indexOf(f)>-1&&d.push(f)}a.$parent.childrenRows=d}else a.$parent.childrenRows=b}),a.isCollapseDisabled=function(){return!a.$parent.childrenRows||0===a.$parent.childrenRows.length},a.getValue=function(){return a.row.model.name},a.getRowContent=function(){if(void 0!==a.row.model.content)return a.row.model.content;if(void 0!==a.pluginScope.content)return a.pluginScope.content;var b=a.row.rowsManager.gantt.options.value("rowContent");return void 0===b&&(b="{{row.model.name}}"),b},a.$watch("collapsed",function(b){if(a.$modelValue._collapsed!==b){var c=a.$modelValue._collapsed;a.$modelValue._collapsed=b,void 0!==c&&b!==c&&(a.gantt.api.tree.raise.collapsed(a,a.$modelValue,b),a.gantt.api.rows.refresh())}})}])}(),function(){"use strict";angular.module("gantt.tree").directive("ganttTreeBody",["GanttDirectiveBuilder","ganttLayout",function(a,b){var c=new a("ganttTreeBody","plugins/tree/treeBody.tmpl.html");return c.controller=function(a){a.getLabelsCss=function(){var b={};return a.maxHeight&&(b["max-height"]=a.maxHeight-a.gantt.header.getHeight()+"px"),b}},c.build()}])}(),function(){"use strict";angular.module("gantt.tree").directive("ganttTreeHeader",["GanttDirectiveBuilder",function(a){return new a("ganttTreeHeader","plugins/tree/treeHeader.tmpl.html").build()}])}(),angular.module("gantt.tree.templates",[]).run(["$templateCache",function(a){a.put("plugins/tree/sideContentTree.tmpl.html",'<div class="gantt-side-content-tree" ng-controller="GanttTreeController"><gantt-tree-header></gantt-tree-header><gantt-tree-body></gantt-tree-body></div>'),a.put("plugins/tree/treeBody.tmpl.html",'<div class="gantt-tree-body" ng-style="getLabelsCss()"><div class="gantt-scrollable--receiver-vertical" gantt-vertical-scroll-receiver><div class="gantt-row-label-background"><div class="gantt-row-label gantt-row-height {{::row.model.classes}}" ng-repeat="row in gantt.rowsManager.visibleRows track by row.model.id">&nbsp;</div></div><div ui-tree ng-controller="GanttUiTreeController" data-drag-enabled="false" data-empty-place-holder-enabled="false"><ol class="gantt-tree-root" ui-tree-nodes ng-model="rootRows"><li ng-repeat="row in rootRows track by row.model.id" ui-tree-node data-collapsed="toCollapse(row)" ng-include="\'plugins/tree/treeBodyChildren.tmpl.html\'"></li></ol></div></div></div>'),a.put("plugins/tree/treeBodyChildren.tmpl.html",'<div ng-controller="GanttTreeNodeController" class="gantt-row-label gantt-row-height {{::row.model.classes}}"><a ng-if="childrenRows!=null" ng-disabled="isCollapseDisabled()" data-nodrag class="gantt-tree-handle-button btn btn-xs" ng-click="!isCollapseDisabled() && toggle()"><span class="gantt-tree-handle fa fa-fw fa-caret-down" ng-class="{\'fa-caret-right\': collapsed, \'fa-caret-down\': !collapsed}"></span> </a><span gantt-row-label class="gantt-label-text" gantt-bind-once-compile-html="getRowContent()"></div><ol ng-if="childrenRows!=null" ui-tree-nodes ng-class="{hidden: collapsed}" ng-model="childrenRows"><li ng-repeat="row in childrenRows track by row.model.id" ui-tree-node data-collapsed="false"><div ng-include="\'plugins/tree/treeBodyChildren.tmpl.html\'"></div></li></ol>'),a.put("plugins/tree/treeHeader.tmpl.html",'<div class="gantt-tree-header" ng-style="{height: $parent.ganttHeaderHeight + \'px\'}"><div ng-if="$parent.ganttHeaderHeight" class="gantt-row-label gantt-row-label-header gantt-tree-row gantt-tree-header-row"><span class="gantt-label-text" gantt-bind-once-compile-html="getHeaderContent()"></div></div>')}]);
//# sourceMappingURL=angular-gantt-tree-plugin.min.js.map